# academicol-service

Сервис (демон для автоматического уведомления о заменах в расписании)
Работает через стороннее API.
Сервис разделен на 2 сервиса.
1. `bot.php` -- сервис обработки команд пользователей, введенных через сообщения сообщесва (+ в беседах)
2. `notifications.php` -- сервис автоматического поиска и уведомления о заменах

# Краткий алгоритм работы поиска замен

1. Проверяем API на наличие изменений.

2. Если изменения найдены

2.1. Проверяем актуальность замен по полям *дата_вступления_замены* и *имя_замены* (проверяем что такой замены нет в базе, иначе -- игнорим

2.2. Считываем содержимое *.doc файла замены.

2.3. Ищем в заменах инициалы преподавателей и группы (по регуляркам).

2.4. Записывавем все что нашли в базу данных.

3. Автоудаление замен из базы

3.1. Ищем все устаревшие замены.

3.2. Чистим сохраненые теги для этих замен

3.3. Чистим информацию о заменах

4. Рассылка уведомлений об изменениях в расписании.

4.1. Выбираем по 20 заданий для уведомления (задания формируются во время исполнения этапа `п. 2.4`).

4.2. Определяем тип задания (ответить пользователю в вк, ответить на почту(не реализованно), и т.д.)

4.3. При отправке через ВК, формируем execute запрос. 

4.4. Удаляем задания из списка.

4.5. Возвращаемся к `п. 4.` и смотрим есть ли еще замены.

4.6. Определяем сколько времени нам осталось спать до следующего пробуждения.

4.7. Спим.

4.8. Просыпаемся, повторяем `п. 1.`
